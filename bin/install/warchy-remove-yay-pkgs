#!/usr/bin/env bash
set -euo pipefail

# Check if arguments were provided
if [ $# -eq 0 ]; then
    gum style --foreground 196 "✖ Error: No packages provided as arguments."
    echo "Usage: $0 package1 package2 ..."
    exit 1
fi

# Arrays to categorize packages
to_remove=()
not_installed=()

# Loop through all packages and categorize
for pkg in "$@"; do
    if yay -Qq "$pkg" >/dev/null 2>&1; then
        to_remove+=("$pkg")
    else
        not_installed+=("$pkg")
    fi
done

# 1. Print summary
if [ "${#to_remove[@]}" -gt 0 ]; then
    gum style --foreground 245 "→ Packages to remove:"
    printf "%s\n" "${to_remove[@]}" | gum style --foreground 212 --padding "0 0 0 4"
fi

if [ "${#not_installed[@]}" -gt 0 ]; then
    gum style --foreground 245 "→ Packages not installed:"
    printf "%s\n" "${not_installed[@]}" | gum style --foreground 196 --padding "0 0 0 4"
fi
echo

# 2. Remove installed packages
if [ "${#to_remove[@]}" -gt 0 ]; then
    for pkg in "${to_remove[@]}"; do
        sudo yay -Rns --noconfirm "$pkg"
        gum style --foreground 212 "✔ Removed package: $pkg"
    done
fi
