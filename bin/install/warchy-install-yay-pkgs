#!/usr/bin/env bash
set -euo pipefail

# Check if arguments were provided
if [ $# -eq 0 ]; then
    gum style --foreground 196 "✖ Error: No packages provided as arguments."
    echo "Usage: $0 package1 package2 ..."
    exit 1
fi

# Store all arguments into the packages array
packages=("$@")

# Arrays to categorize packages
to_install=()
already_installed=()
not_found=()

# Loop through each requested package
for pkg in "${packages[@]}"; do
    if yay -Qq "$pkg" >/dev/null 2>&1; then
        already_installed+=("$pkg")
    elif yay -Ss "^$pkg$" >/dev/null 2>&1; then
        to_install+=("$pkg")
    else
        not_found+=("$pkg")
    fi
done

# 1. Print summary
if [ "${#to_install[@]}" -gt 0 ]; then
    gum style --foreground 245 "→ Packages to install:"
    printf "%s\n" "${to_install[@]}" | gum style --foreground 212 --padding "0 0 0 4"
fi

if [ "${#already_installed[@]}" -gt 0 ]; then
    gum style --foreground 245 " → Already installed packages:"
    printf "%s\n" "${already_installed[@]}" | gum style --foreground 33 --padding "0 0 0 4"
fi

if [ "${#not_found[@]}" -gt 0 ]; then
    gum style --foreground 245 " → Packages not found in repositories:"
    printf "%s\n" "${not_found[@]}" | gum style --foreground 196 --padding "0 0 0 4"
fi
echo

# 2. Confirm / proceed with installation
if [ "${#to_install[@]}" -gt 0 ]; then
    yay -S --noconfirm --needed "${to_install[@]}"
    gum style --foreground 212 "✔ Installation complete."
fi

