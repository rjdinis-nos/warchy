#!/usr/bin/env bash
# =============================================================================
# Script: list_shell_functions.sh
# Purpose: List all functions defined in the current Bash session
# =============================================================================

CYAN="\033[1;36m"
YELLOW="\033[1;33m"
GREEN="\033[1;32m"
RED="\033[1;31m"
RESET="\033[0m"

# Check if the script is sourced
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    echo -e "${RED}This script must be sourced to list shell functions!${RESET}"
    echo -e "Run it like this:"
    echo -e "  ${CYAN}source ${BASH_SOURCE[0]}${RESET}"
    exit 1
fi


# If an argument is provided, treat it as a function name
if [[ -n "$1" ]]; then
    func_name="$1"
    if declare -F "$func_name" > /dev/null; then
        declare -f "$func_name"
    else
        echo -e "${RED}Function '${func_name}' not found!${RESET}"
    fi
    return 0
fi


echo -e "${CYAN}===== Shell Functions =====${RESET}"

# Collect internal/helper and user-defined functions
internal_funcs=()
user_funcs=()

while read -r f; do
    if [[ $f == __* || $f == _* ]]; then
        internal_funcs+=("$f")
    else
        user_funcs+=("$f")
    fi
done < <(declare -F | awk '{print $3}')

# Sort both arrays alphabetically
IFS=$'\n' internal_funcs=($(sort <<<"${internal_funcs[*]}"))
IFS=$'\n' user_funcs=($(sort <<<"${user_funcs[*]}"))
unset IFS

# Print internal functions first
for f in "${internal_funcs[@]}"; do
    echo -e "${YELLOW}${f}${RESET}"
done

# Print user-defined functions next
for f in "${user_funcs[@]}"; do
    echo -e "${GREEN}${f}${RESET}"
done
